<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PocketPaw</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='15' fill='%230A84FF'/><g transform='translate(4,4)' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='4' r='2'/><circle cx='3' cy='7' r='2'/><circle cx='19' cy='7' r='2'/><circle cx='7' cy='19' r='2'/><circle cx='15' cy='19' r='2'/><path d='M8 14v.5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V14a4 4 0 0 0-6 0z'/></g></svg>"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/css/styles.css" />

    <!-- UnoCSS Runtime (utilities alongside custom CSS) -->
    <script>
      window.__unocss = {
        theme: {
          colors: {
            accent: '#0A84FF',
            success: '#30D158',
            danger: '#FF453A',
            warning: '#FF9F0A',
          }
        },
        shortcuts: {
          'glass': 'bg-white/10 backdrop-blur-xl border border-white/12 rounded-2xl',
          'glass-dark': 'bg-black/30 backdrop-blur-xl border border-white/12 rounded-2xl',
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"
    ></script>
  </head>
  <body x-data="app()" x-init="init()">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo flex items-center gap-3">
        <i data-lucide="paw-print" class="w-6 h-6 text-accent"></i>
        <span>PocketPaw</span>
      </div>

      <!-- Tools Section -->
      <nav class="nav-section">
        <h3 class="nav-title">Tools</h3>
        <button class="nav-item flex items-center gap-3" @click="runTool('fetch')">
          <i data-lucide="folder" class="w-5 h-5"></i>
          <span>Files</span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="runTool('screenshot')">
          <i data-lucide="camera" class="w-5 h-5"></i>
          <span>Screenshot</span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="openReminders()">
          <i data-lucide="bell" class="w-5 h-5"></i>
          <span>Reminders</span>
          <span
            x-show="reminders.length > 0"
            class="ml-auto bg-accent/20 text-accent text-xs px-2 py-0.5 rounded-full"
            x-text="reminders.length"
          ></span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="openIntentions()">
          <i data-lucide="target" class="w-5 h-5"></i>
          <span>Intentions</span>
          <span
            x-show="intentions.filter(i => i.enabled).length > 0"
            class="ml-auto bg-success/20 text-success text-xs px-2 py-0.5 rounded-full"
            x-text="intentions.filter(i => i.enabled).length"
          ></span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="openSkills()">
          <i data-lucide="wand-2" class="w-5 h-5"></i>
          <span>Skills</span>
          <span
            x-show="skills.length > 0"
            class="ml-auto bg-warning/20 text-warning text-xs px-2 py-0.5 rounded-full"
            x-text="skills.length"
          ></span>
        </button>
        <button class="nav-item danger flex items-center gap-3" @click="runTool('panic')">
          <i data-lucide="octagon-x" class="w-5 h-5"></i>
          <span>Panic</span>
        </button>
      </nav>
      </nav>

      <!-- Transparency Section -->
      <nav class="nav-section">
        <h3 class="nav-title">Brain</h3>
        <button class="nav-item flex items-center gap-3" @click="openIdentity()">
          <i data-lucide="fingerprint" class="w-5 h-5"></i>
          <span>Identity</span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="openMemory()">
          <i data-lucide="brain-circuit" class="w-5 h-5"></i>
          <span>Memory</span>
        </button>
        <button class="nav-item flex items-center gap-3" @click="openAudit()">
          <i data-lucide="shield-check" class="w-5 h-5"></i>
          <span>Audit Log</span>
        </button>
      </nav>

      <!-- Config Section -->
      <nav class="nav-section">
        <h3 class="nav-title">Config</h3>
        <button class="nav-item flex items-center gap-3" @click="showSettings = true">
          <i data-lucide="settings" class="w-5 h-5"></i>
          <span>Settings</span>
        </button>

      </nav>

      <!-- System Status Widget -->
      <div class="glass-dark mt-auto p-4">
        <div class="grid grid-cols-2 gap-4">
          <div class="flex items-center gap-2">
            <i data-lucide="cpu" class="w-4 h-4 text-white/40"></i>
            <div class="flex flex-col">
              <span class="text-xs text-white/50">CPU</span>
              <span class="text-sm font-mono" x-text="typeof status.cpu === 'number' ? status.cpu + '%' : status.cpu"></span>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <i data-lucide="memory-stick" class="w-4 h-4 text-white/40"></i>
            <div class="flex flex-col">
              <span class="text-xs text-white/50">RAM</span>
              <span class="text-sm font-mono" x-text="typeof status.ram === 'number' ? status.ram + '%' : status.ram"></span>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <i data-lucide="hard-drive" class="w-4 h-4 text-white/40"></i>
            <div class="flex flex-col">
              <span class="text-xs text-white/50">Disk</span>
              <span class="text-sm font-mono" x-text="typeof status.disk === 'number' ? status.disk + '%' : status.disk"></span>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <i data-lucide="battery-medium" class="w-4 h-4 text-white/40"></i>
            <div class="flex flex-col">
              <span class="text-xs text-white/50">Bat</span>
              <span class="text-sm font-mono" x-text="typeof status.battery === 'number' ? status.battery + '%' : status.battery"></span>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Top Bar -->
      <header class="topbar">
        <div class="view-toggle">
          <button
            class="view-btn"
            :class="{ active: view === 'chat' }"
            @click="view = 'chat'"
          >
            Chat
          </button>
          <button
            class="view-btn"
            :class="{ active: view === 'activity' }"
            @click="view = 'activity'"
          >
            Activity
          </button>
          <button
            class="view-btn"
            :class="{ active: view === 'terminal' }"
            @click="view = 'terminal'"
          >
            Terminal
          </button>
        </div>

        <!-- Center Action Button -->
        <div class="flex-1 flex justify-center">
            <button 
                class="flex items-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 px-4 py-1.5 rounded-full transition-all hover:scale-105 active:scale-95" 
                @click="openRemote()"
            >
                <i data-lucide="smartphone" class="w-4 h-4 text-accent"></i>
                <span class="text-sm font-medium text-white/90">Take Your Paw With You</span>
            </button>
        </div>

        <div class="agent-toggle">
          <span class="agent-label">Agent Mode</span>
          <label class="switch">
            <input
              type="checkbox"
              x-model="agentActive"
              @change="toggleAgent()"
            />
            <span class="slider"></span>
          </label>
          <!-- Agent Mode Badge -->
          <span
            x-show="agentActive"
            class="agent-mode-badge"
            x-text="getAgentModeLabel()"
          ></span>
        </div>
      </header>

      <!-- Chat View -->
      <div class="chat-container" x-show="view === 'chat'">
        <div class="messages" x-ref="messages">
          <template x-for="(msg, index) in messages" :key="index">
            <div class="message" :class="msg.role">
              <div
                class="message-content"
                x-html="formatMessage(msg.content)"
              ></div>
              <div class="message-header">
                <span
                  class="message-author"
                  x-text="msg.role === 'user' ? 'You' : 'PocketPaw'"
                ></span>
                <span class="message-time" x-text="msg.time"></span>
              </div>
            </div>
          </template>

          <!-- Streaming indicator -->
          <div class="message assistant" x-show="isStreaming">
            <div class="message-content">
              <span x-text="streamingContent"></span>
              <span class="typing-indicator">▌</span>
            </div>
            <div class="message-header">
              <span class="message-author">PocketPaw</span>
              <span class="message-time" x-text="currentTime()"></span>
            </div>
          </div>
        </div>

        <form class="input-area" @submit.prevent="sendMessage()">
          <input
            type="text"
            class="chat-input"
            placeholder="Type a message..."
            x-model="inputText"
            :disabled="isStreaming"
          />
          <button
            type="submit"
            class="send-btn"
            :disabled="!inputText.trim() || isStreaming"
          >
            <i data-lucide="arrow-up" class="w-4 h-4"></i>
          </button>
        </form>
      </div>

      <!-- Activity View -->
      <div class="terminal-container" x-show="view === 'activity'">
        <div class="terminal-output" x-ref="activityLog">
          <template x-for="(log, index) in activityLog" :key="index">
            <div class="term-line" :class="'term-' + log.level">
              <span class="term-time" x-text="log.time"></span>
              <span x-html="log.message"></span>
            </div>
          </template>
        </div>
      </div>

      <!-- Terminal View -->
      <div class="terminal-container" x-show="view === 'terminal'">
        <div class="terminal-output" x-ref="terminal">
          <template x-for="(log, index) in logs" :key="index">
            <div class="term-line" :class="'term-' + log.level">
              <span class="term-time" x-text="log.time"></span>
              <span x-text="log.message"></span>
            </div>
          </template>
        </div>
      </div>
    </main>

    <!-- Settings Modal -->
    <div
      class="modal-overlay"
      x-show="showSettings"
      x-transition.opacity
      @click.self="showSettings = false"
    >
      <div class="modal" @click.stop>
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="close-btn" @click="showSettings = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Agent Backend</label>
            <select x-model="settings.agentBackend" @change="saveSettings()">
              <option value="claude_agent_sdk">Claude Agent SDK (Recommended)</option>
              <option value="pocketpaw_native">PocketPaw Native</option>
              <option value="open_interpreter">Open Interpreter</option>
            </select>
            <small class="text-white/50 text-xs mt-1 block" x-text="getBackendDescription(settings.agentBackend)"></small>
          </div>
          <div class="form-group">
            <label>LLM Provider</label>
            <select x-model="settings.llmProvider" @change="saveSettings()">
              <option value="auto">Auto</option>
              <option value="anthropic">Anthropic</option>
              <option value="openai">OpenAI</option>
              <option value="ollama">Ollama</option>
            </select>
          </div>
          <div class="form-group" x-show="settings.llmProvider === 'anthropic' || settings.llmProvider === 'auto'">
            <label>Anthropic Model</label>
            <select x-model="settings.anthropicModel" @change="saveSettings()">
              <optgroup label="Claude 4.5 (Latest)">
                <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5 (Recommended)</option>
                <option value="claude-opus-4-5-20250929">Claude Opus 4.5</option>
                <option value="claude-haiku-4-5-20250929">Claude Haiku 4.5</option>
              </optgroup>
              <optgroup label="Claude 4">
                <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                <option value="claude-opus-4-20250514">Claude Opus 4</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" x-model="settings.bypassPermissions" @change="saveSettings()">
              <span>Bypass Permission Prompts</span>
            </label>
            <small style="color: var(--text-secondary); display: block; margin-top: 4px;">
              ⚠️ Agent will execute actions without asking for approval. Use with caution.
            </small>
          </div>
          <hr />
          <h3>API Keys</h3>
          <div class="form-group">
            <label>
              Anthropic API Key 
              <span x-show="hasAnthropicKey" style="color: var(--success-color);">✓ Saved</span>
            </label>
            <div class="input-group">
              <input
                type="password"
                x-model="apiKeys.anthropic"
                :placeholder="hasAnthropicKey ? '••••••••••••••••' : 'sk-ant-...'"
              />
              <button class="btn-sm" @click="saveApiKey('anthropic')">
                Save
              </button>
            </div>
          </div>
          <div class="form-group">
            <label>
              OpenAI API Key
              <span x-show="hasOpenaiKey" style="color: var(--success-color);">✓ Saved</span>
            </label>
            <div class="input-group">
              <input
                type="password"
                x-model="apiKeys.openai"
                :placeholder="hasOpenaiKey ? '••••••••••••••••' : 'sk-...'"
              />
              <button class="btn-sm" @click="saveApiKey('openai')">Save</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Screenshot Modal -->
    <div
      class="modal-overlay"
      x-show="showScreenshot"
      x-transition.opacity
      @click.self="showScreenshot = false"
    >
      <div class="modal modal-lg" @click.stop>
        <div class="modal-header">
          <h2>Screenshot</h2>
          <button class="close-btn" @click="showScreenshot = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <img
            :src="screenshotSrc"
            alt="Screenshot"
            class="screenshot-preview"
          />
        </div>
      </div>
    </div>

    <!-- File Browser Modal -->
    <div
      class="modal-overlay"
      x-show="showFileBrowser"
      x-transition.opacity
      @click.self="showFileBrowser = false"
    >
      <div class="modal modal-lg" @click.stop>
        <div class="modal-header">
          <h2>Files</h2>
          <button class="close-btn" @click="showFileBrowser = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <!-- UnoCSS: flex flex-col gap-4 instead of .file-browser -->
          <div class="flex flex-col gap-4">

            <!-- Path bar: UnoCSS for layout, keep custom styling -->
            <div class="file-path flex items-center gap-1">
              <span class="file-path-home flex items-center gap-1" @click="navigateTo('~')">
                <i data-lucide="home" class="w-4 h-4"></i>
              </span>
              <template x-for="(segment, i) in filePath.split('/').filter(s => s)" :key="i">
                <span class="flex items-center">
                  <span class="text-white/30 mx-1">/</span>
                  <span
                    class="cursor-pointer hover:text-accent transition-colors"
                    @click="navigateToSegment(i)"
                    x-text="segment"
                  ></span>
                </span>
              </template>
            </div>

            <!-- Loading State -->
            <template x-if="fileLoading">
              <div class="p-8 text-center text-white/60 flex flex-col items-center gap-2">
                <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                <span>Loading...</span>
              </div>
            </template>

            <!-- Error State -->
            <template x-if="!fileLoading && fileError">
              <div class="p-4 text-center text-danger bg-danger/10 rounded-lg" x-text="fileError"></div>
            </template>

            <!-- File List (only when loaded and no error) -->
            <template x-if="!fileLoading && !fileError">
              <div class="file-list">
                <!-- Parent Directory (only when not at home) -->
                <template x-if="filePath && filePath !== '~' && filePath !== '.'">
                  <div
                    class="file-item flex items-center gap-3 text-accent"
                    @click="navigateUp()"
                  >
                    <i data-lucide="corner-left-up" class="w-5 h-5"></i>
                    <span class="flex-1 font-medium">..</span>
                  </div>
                </template>

                <!-- Files & Folders -->
                <template x-for="item in files" :key="item.name">
                  <div class="file-item flex items-center gap-3" @click="selectFile(item)">
                    <svg x-show="item.isDir" class="w-5 h-5 text-white/60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>
                    <svg x-show="!item.isDir" class="w-5 h-5 text-white/60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                    <span class="flex-1 font-medium truncate" x-text="item.name + (item.isDir ? '/' : '')"></span>
                    <span class="text-xs text-white/30 font-mono" x-show="!item.isDir" x-text="item.size"></span>
                  </div>
                </template>

                <!-- Empty State -->
                <template x-if="files.length === 0">
                  <div class="p-8 text-center text-white/40 flex flex-col items-center gap-2">
                    <i data-lucide="folder-open" class="w-8 h-8"></i>
                    <span>Empty directory</span>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- Reminders Modal -->
    <div
      class="modal-overlay"
      x-show="showReminders"
      x-transition.opacity
      @click.self="showReminders = false"
    >
      <div class="modal modal-lg" @click.stop>
        <div class="modal-header">
          <h2>Reminders</h2>
          <button class="close-btn" @click="showReminders = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <div class="flex flex-col gap-4">
            <!-- Add Reminder Input -->
            <form class="flex gap-2" @submit.prevent="addReminder()">
              <input
                type="text"
                class="reminder-input flex-1"
                x-model="reminderInput"
                placeholder="Remind me in 30 minutes to..."
                :disabled="reminderLoading"
              />
              <button
                type="submit"
                class="btn-sm"
                :disabled="!reminderInput.trim() || reminderLoading"
              >
                <i data-lucide="plus" class="w-4 h-4"></i>
              </button>
            </form>

            <p class="text-xs text-white/40">
              Try: "in 5 minutes", "at 3pm", "tomorrow at 9am"
            </p>

            <!-- Loading State -->
            <template x-if="reminderLoading && reminders.length === 0">
              <div class="p-8 text-center text-white/60 flex flex-col items-center gap-2">
                <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                <span>Loading...</span>
              </div>
            </template>

            <!-- Reminders List -->
            <template x-if="!reminderLoading || reminders.length > 0">
              <div class="reminder-list">
                <template x-for="reminder in reminders" :key="reminder.id">
                  <div class="reminder-item flex items-start gap-3">
                    <i data-lucide="bell" class="w-5 h-5 text-accent mt-0.5 flex-shrink-0"></i>
                    <div class="flex-1 min-w-0">
                      <p class="font-medium truncate" x-text="reminder.text"></p>
                      <p class="text-xs text-white/50">
                        <span x-text="formatReminderTime(reminder)"></span>
                        <span class="text-accent ml-2" x-text="reminder.time_remaining"></span>
                      </p>
                    </div>
                    <button
                      class="icon-btn-sm flex-shrink-0"
                      @click="deleteReminder(reminder.id)"
                      title="Delete reminder"
                    >
                      <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                  </div>
                </template>

                <!-- Empty State -->
                <template x-if="reminders.length === 0">
                  <div class="p-8 text-center text-white/40 flex flex-col items-center gap-2">
                    <i data-lucide="bell-off" class="w-8 h-8"></i>
                    <span>No reminders set</span>
                    <span class="text-xs">Add one above to get started</span>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- Intentions Modal -->
    <div
      class="modal-overlay"
      x-show="showIntentions"
      x-transition.opacity
      @click.self="showIntentions = false"
    >
      <div class="modal modal-lg" @click.stop>
        <div class="modal-header">
          <h2>Intentions</h2>
          <button class="close-btn" @click="showIntentions = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <div class="flex flex-col gap-4">
            <!-- Add Intention Form -->
            <div class="glass-dark p-4 rounded-xl">
              <h3 class="text-sm font-medium mb-3">New Intention</h3>
              <div class="flex flex-col gap-3">
                <input
                  type="text"
                  class="intention-input"
                  x-model="intentionForm.name"
                  placeholder="Name (e.g., Morning Standup)"
                />
                <textarea
                  class="intention-input"
                  x-model="intentionForm.prompt"
                  placeholder="Prompt (e.g., Good morning! What are your priorities today?)"
                  rows="2"
                ></textarea>
                <div class="flex gap-2">
                  <select class="intention-input flex-1" x-model="intentionForm.schedulePreset">
                    <option value="">Select schedule...</option>
                    <option value="every_minute">Every minute (testing)</option>
                    <option value="every_5_minutes">Every 5 minutes</option>
                    <option value="every_15_minutes">Every 15 minutes</option>
                    <option value="every_hour">Every hour</option>
                    <option value="every_morning_8am">Daily at 8am</option>
                    <option value="every_morning_9am">Daily at 9am</option>
                    <option value="weekday_morning_8am">Weekdays at 8am</option>
                    <option value="weekday_morning_9am">Weekdays at 9am</option>
                    <option value="daily_noon">Daily at noon</option>
                    <option value="every_evening_6pm">Daily at 6pm</option>
                    <option value="custom">Custom cron...</option>
                  </select>
                  <input
                    x-show="intentionForm.schedulePreset === 'custom'"
                    type="text"
                    class="intention-input flex-1"
                    x-model="intentionForm.customCron"
                    placeholder="0 9 * * 1-5"
                  />
                </div>
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="includeSystemStatus" x-model="intentionForm.includeSystemStatus" />
                  <label for="includeSystemStatus" class="text-sm text-white/60">Include system status in prompt</label>
                </div>
                <button
                  class="btn-primary"
                  @click="createIntention()"
                  :disabled="!intentionForm.name.trim() || !intentionForm.prompt.trim() || !intentionForm.schedulePreset"
                >
                  <i data-lucide="plus" class="w-4 h-4"></i>
                  <span>Add Intention</span>
                </button>
              </div>
            </div>

            <!-- Loading State -->
            <template x-if="intentionLoading && intentions.length === 0">
              <div class="p-8 text-center text-white/60 flex flex-col items-center gap-2">
                <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                <span>Loading...</span>
              </div>
            </template>

            <!-- Intentions List -->
            <template x-if="!intentionLoading || intentions.length > 0">
              <div class="intention-list">
                <template x-for="intention in intentions" :key="intention.id">
                  <div class="intention-item" :class="{ 'opacity-50': !intention.enabled }">
                    <div class="flex items-start gap-3">
                      <button
                        class="intention-toggle mt-0.5"
                        @click="toggleIntention(intention.id)"
                        :title="intention.enabled ? 'Disable' : 'Enable'"
                      >
                        <i x-show="intention.enabled" data-lucide="toggle-right" class="w-5 h-5 text-success"></i>
                        <i x-show="!intention.enabled" data-lucide="toggle-left" class="w-5 h-5 text-white/30"></i>
                      </button>
                      <div class="flex-1 min-w-0">
                        <p class="font-medium" x-text="intention.name"></p>
                        <p class="text-xs text-white/50 truncate" x-text="intention.prompt"></p>
                        <div class="flex items-center gap-2 mt-1">
                          <span class="text-xs text-white/30">
                            <i data-lucide="clock" class="w-3 h-3 inline"></i>
                            <span x-text="intention.trigger?.schedule || 'No schedule'"></span>
                          </span>
                          <span x-show="intention.next_run" class="text-xs text-accent">
                            Next: <span x-text="formatNextRun(intention.next_run)"></span>
                          </span>
                        </div>
                      </div>
                      <div class="flex items-center gap-1">
                        <button
                          class="icon-btn-sm"
                          @click="runIntention(intention.id)"
                          title="Run now"
                        >
                          <i data-lucide="play" class="w-4 h-4"></i>
                        </button>
                        <button
                          class="icon-btn-sm"
                          @click="deleteIntention(intention.id)"
                          title="Delete"
                        >
                          <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </template>

                <!-- Empty State -->
                <template x-if="intentions.length === 0">
                  <div class="p-8 text-center text-white/40 flex flex-col items-center gap-2">
                    <i data-lucide="target" class="w-8 h-8"></i>
                    <span>No intentions set</span>
                    <span class="text-xs">Create one above to make PocketPaw proactive</span>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- Skills Modal -->
    <div
      class="modal-overlay"
      x-show="showSkills"
      x-transition.opacity
      @click.self="showSkills = false"
    >
      <div class="modal modal-lg" @click.stop>
        <div class="modal-header">
          <h2>Skills</h2>
          <button class="close-btn" @click="showSkills = false"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="modal-body">
          <div class="flex flex-col gap-4">
            <!-- Info -->
            <p class="text-sm text-white/60">
              Skills extend PocketPaw with specialized capabilities. Use <code class="text-accent">/skill-name</code> in chat to run a skill.
              Install more from <a href="https://skills.sh" target="_blank" class="text-accent hover:underline">skills.sh</a>
            </p>

            <!-- Loading State -->
            <template x-if="skillsLoading && skills.length === 0">
              <div class="p-8 text-center text-white/60 flex flex-col items-center gap-2">
                <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                <span>Loading skills...</span>
              </div>
            </template>

            <!-- Skills List -->
            <template x-if="!skillsLoading || skills.length > 0">
              <div class="skill-list">
                <template x-for="skill in skills" :key="skill.name">
                  <div class="skill-item">
                    <div class="flex items-start gap-3">
                      <i data-lucide="wand-2" class="w-5 h-5 text-warning mt-0.5 flex-shrink-0"></i>
                      <div class="flex-1 min-w-0">
                        <p class="font-medium">
                          <span class="text-accent">/</span><span x-text="skill.name"></span>
                          <span x-show="skill.argument_hint" class="text-white/30 text-sm ml-1" x-text="skill.argument_hint"></span>
                        </p>
                        <p class="text-xs text-white/50 line-clamp-2" x-text="skill.description"></p>
                      </div>
                      <button
                        class="btn-sm flex-shrink-0"
                        @click="runSkill(skill.name); showSkills = false;"
                      >
                        Run
                      </button>
                    </div>
                  </div>
                </template>

                <!-- Empty State -->
                <template x-if="skills.length === 0">
                  <div class="p-8 text-center text-white/40 flex flex-col items-center gap-2">
                    <i data-lucide="wand-2" class="w-8 h-8"></i>
                    <span>No skills installed</span>
                    <span class="text-xs">Install skills with: <code class="text-accent">npx skills add owner/repo</code></span>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- Identity Modal -->
    <div class="modal-overlay" x-show="showIdentity" x-transition.opacity @click.self="showIdentity = false">
        <div class="modal modal-lg" @click.stop>
            <div class="modal-header">
                <h2>Agent Identity</h2>
                <button class="close-btn" @click="showIdentity = false"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body">
                <div x-show="identityLoading" class="p-8 text-center text-white/50"><i data-lucide="loader-2" class="animate-spin inline mr-2"></i> Loading identity...</div>
                <div x-show="!identityLoading" class="flex flex-col gap-4">
                    <div class="glass-dark p-4 rounded-xl">
                        <h3 class="text-accent mb-2">Primary Directive (IDENTITY.md)</h3>
                        <pre class="text-xs text-white/70 whitespace-pre-wrap font-mono" x-text="identityData.identity_file"></pre>
                    </div>
                     <div class="glass-dark p-4 rounded-xl">
                        <h3 class="text-accent mb-2">Soul & Personality (SOUL.md)</h3>
                        <pre class="text-xs text-white/70 whitespace-pre-wrap font-mono" x-text="identityData.soul_file"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Memory Modal -->
    <div class="modal-overlay" x-show="showMemory" x-transition.opacity @click.self="showMemory = false">
        <div class="modal modal-lg" @click.stop>
            <div class="modal-header">
                <h2>Memory Banks</h2>
                <button class="close-btn" @click="showMemory = false"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body">
                 <div class="flex gap-2 mb-4">
                    <button class="view-btn" :class="{ active: memoryTab === 'session' }" @click="memoryTab = 'session'">Session</button>
                    <button class="view-btn" :class="{ active: memoryTab === 'long_term' }" @click="memoryTab = 'long_term'">Long Term</button>
                 </div>
                 
                 <div x-show="memoryTab === 'session'" class="flex flex-col gap-3 max-h-[400px] overflow-y-auto">
                    <template x-for="item in sessionMemory" :key="item.content">
                        <div class="glass-dark p-3 rounded-lg border-l-2" :class="item.role === 'user' ? 'border-accent' : 'border-success'">
                            <div class="flex justify-between text-xs text-white/40 mb-1">
                                <span x-text="item.role.toUpperCase()"></span>
                            </div>
                            <div class="text-sm text-white/80 whitespace-pre-wrap" x-text="item.content"></div>
                        </div>
                    </template>
                 </div>

                 <div x-show="memoryTab === 'long_term'" class="flex flex-col gap-3 max-h-[400px] overflow-y-auto">
                    <template x-for="item in longTermMemory" :key="item.timestamp">
                        <div class="glass-dark p-3 rounded-lg border-l-2 border-warning">
                            <div class="flex justify-between text-xs text-white/40 mb-1">
                                <span x-text="new Date(item.timestamp).toLocaleString()"></span>
                                <div class="flex gap-1">
                                    <template x-for="tag in item.tags">
                                        <span class="bg-white/10 px-1 rounded" x-text="tag"></span>
                                    </template>
                                </div>
                            </div>
                            <div class="text-sm text-white/80" x-text="item.content"></div>
                        </div>
                    </template>
                 </div>
            </div>
        </div>
    </div>

    <!-- Audit Log Modal -->
    <div class="modal-overlay" x-show="showAudit" x-transition.opacity @click.self="showAudit = false">
        <div class="modal modal-lg" @click.stop style="width: 800px;">
            <div class="modal-header">
                <h2>Audit Log</h2>
                <button class="close-btn" @click="showAudit = false"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body">
                <div x-show="auditLoading" class="p-4 text-center"><i data-lucide="loader-2" class="animate-spin"></i></div>
                <div class="flex flex-col gap-2 max-h-[500px] overflow-y-auto font-mono text-xs">
                    <template x-for="log in auditLogs" :key="log.id">
                        <div class="p-2 rounded border-l-4 bg-white/5" 
                             :class="{
                                'border-info': log.severity === 'info',
                                'border-warning': log.severity === 'warning',
                                'border-danger': log.severity === 'critical' || log.severity === 'alert'
                             }">
                            <div class="flex justify-between text-white/50 mb-1">
                                <span x-text="new Date(log.timestamp).toLocaleTimeString()"></span>
                                <span x-text="log.severity.toUpperCase()" :class="log.severity === 'critical' ? 'text-danger' : ''"></span>
                            </div>
                            <div class="flex gap-2">
                                <span class="bg-white/10 px-1 rounded text-accent" x-text="log.action"></span>
                                <span class="text-white/90" x-text="log.target"></span>
                            </div>
                            <div class="mt-1 text-white/60 truncate" x-text="JSON.stringify(log.context)"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Remote Access Modal -->
    <div class="modal-overlay" x-show="showRemote" x-transition.opacity @click.self="showRemote = false">
        <div class="modal" @click.stop style="max-width: 400px;">
            <div class="modal-header">
                <h2>Remote Access</h2>
                <button class="close-btn" @click="showRemote = false"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="modal-body">
                <div class="flex flex-col gap-6 items-center text-center">
                    
                    <!-- QR Code -->
                    <div class="bg-white p-2 rounded-xl">
                        <img :src="'/api/qr?t=' + Date.now()" alt="Scan to Login" class="w-48 h-48 block" />
                    </div>
                    
                    <p class="text-white/60 text-sm">
                        Scan with your phone to access PocketPaw remotely.
                    </p>

                    <!-- Tunnel Controls -->
                    <div class="w-full glass-dark p-4 rounded-xl flex flex-col gap-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">Cloudflare Tunnel</span>
                            <span class="text-xs px-2 py-0.5 rounded-full" 
                                  :class="remoteStatus.active ? 'bg-success/20 text-success' : 'bg-white/10 text-white/50'"
                                  x-text="remoteStatus.active ? 'ONLINE' : 'OFFLINE'">
                            </span>
                        </div>
                        
                        <div x-show="remoteStatus.active" class="text-xs text-accent break-all bg-black/30 p-2 rounded">
                            <a :href="remoteStatus.url" target="_blank" class="hover:underline" x-text="remoteStatus.url"></a>
                        </div>
                        
                        <div class="flex gap-2 mt-1">
                            <button class="btn-primary w-full" 
                                    x-show="!remoteStatus.active" 
                                    @click="toggleTunnel()"
                                    :disabled="tunnelLoading">
                                <i x-show="tunnelLoading" data-lucide="loader-2" class="w-4 h-4 animate-spin mr-1"></i>
                                Start Tunnel
                            </button>
                            
                            <button class="btn-danger w-full" 
                                    x-show="remoteStatus.active" 
                                    @click="toggleTunnel()"
                                    :disabled="tunnelLoading">
                                <i x-show="tunnelLoading" data-lucide="loader-2" class="w-4 h-4 animate-spin mr-1"></i>
                                Stop Tunnel
                            </button>
                        </div>
                    </div>

                    <!-- Token Reset -->
                    <div class="w-full border-t border-white/10 pt-4">
                        <button class="text-xs text-white/40 hover:text-white/70 transition-colors" @click="regenerateToken()">
                            Regenerate Access Token
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" x-ref="toasts"></div>

    <!-- Scripts -->
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/tools.js"></script>
    <script src="/static/js/app.js"></script>

    <!-- Initialize Lucide icons -->
    <script>
      // Initial render
      document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
      });

      // Debounced refresh for dynamic content
      let iconTimeout;
      window.refreshIcons = () => {
        clearTimeout(iconTimeout);
        iconTimeout = setTimeout(() => lucide.createIcons(), 50);
      };
    </script>
  </body>
</html>
